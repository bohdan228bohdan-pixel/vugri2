{% extends 'base.html' %}
{% load static %}

{% block title %}Каталог — VugriUkraine{% endblock %}

{% block head_extra %}
<style>
/* Catalog layout + fixed media sizing */
.catalog-container { color:var(--muted); }
.category-bar { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin:12px 0 18px; }
.category-pill { padding:8px 12px; border-radius:8px; font-weight:800; text-decoration:none; cursor:pointer; border:1px solid rgba(255,255,255,0.06); color:var(--white); background:transparent; }
.category-pill.active { background:var(--accent); color:#fff; border-color:transparent; }

.sort-bar { text-align:center; margin:8px 0 18px; color:var(--muted); font-weight:700; }
.sort-link { color:var(--muted); text-decoration:none; margin:0 8px; padding:6px 10px; border-radius:8px; border:1px solid transparent; }
.sort-link.active { color:var(--white); background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.04); }

.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 20px;
  margin: 0;
  padding: 0;
}

/* Card */
.product-card {
  position: relative;
  display:flex;
  flex-direction:column;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding: 0;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  overflow: hidden;
}

/* Media area: fixed height with cover */
.product-media {
  width:100%;
  height:200px;
  background:#0b0b0b;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}
.product-media img {
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* Body */
.card-body {
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.product-title { margin:0; font-size:1.1rem; font-weight:800; color:var(--white); }
.product-meta { color:var(--muted); font-size:0.95rem; min-height:36px; }
.product-price { font-weight:900; color:var(--white); margin-top:6px; }

/* Actions */
.product-actions {
  display:flex;
  gap:10px;
  padding:16px;
  border-top:1px solid rgba(255,255,255,0.02);
  background: transparent;
}
.btn { padding:8px 14px; border-radius:8px; font-weight:800; text-decoration:none; display:inline-flex; align-items:center; justify-content:center; }
.btn-primary { background:var(--accent); color:#fff; border:0; }
.btn-outline { background:transparent; color:var(--white); border:1px solid rgba(255,255,255,0.06); }

@media (max-width:900px) {
  .product-media { height:160px; }
  .products-grid { gap:16px; }
}
</style>
{% endblock %}

{% block content %}
<main class="catalog-container" style="max-width:1200px;margin:36px auto;padding:0 24px;">
  <h1 style="color:var(--white);text-align:center;margin-bottom:12px">Каталог товарів</h1>

  <!-- Category bar -->
  <nav class="category-bar" aria-label="Категорії">
    <a href="{% url 'products' %}" class="category-pill {% if not selected_category %}active{% endif %}">Усі</a>
    {% for c in categories %}
      {% if c.slug %}
        <a href="{% url 'products' %}?category={{ c.slug }}" class="category-pill {% if selected_category == c.slug %}active{% endif %}">{{ c.name }}</a>
      {% else %}
        <a href="{% url 'products' %}?category={{ c }}" class="category-pill {% if selected_category == c %}active{% endif %}">{{ c }}</a>
      {% endif %}
    {% endfor %}
  </nav>

  <!-- Sort bar (server-side) -->
  <div class="sort-bar" role="region" aria-label="Сортування">
    <a class="sort-link {% if current_sort == 'price_asc' %}active{% endif %}"
       href="{% url 'products' %}{% if selected_category %}?category={{ selected_category }}&sort=price_asc{% else %}?sort=price_asc{% endif %}">Ціна ↑</a>
    <a class="sort-link {% if current_sort == 'price_desc' %}active{% endif %}"
       href="{% url 'products' %}{% if selected_category %}?category={{ selected_category }}&sort=price_desc{% else %}?sort=price_desc{% endif %}">Ціна ↓</a>
    <a class="sort-link {% if current_sort == 'name_asc' %}active{% endif %}"
       href="{% url 'products' %}{% if selected_category %}?category={{ selected_category }}&sort=name_asc{% else %}?sort=name_asc{% endif %}">Назва A→Я</a>
    <a class="sort-link {% if current_sort == 'name_desc' %}active{% endif %}"
       href="{% url 'products' %}{% if selected_category %}?category={{ selected_category }}&sort=name_desc{% else %}?sort=name_desc{% endif %}">Назва Я→A</a>
    <a class="sort-link {% if current_sort == 'newest' %}active{% endif %}"
       href="{% url 'products' %}{% if selected_category %}?category={{ selected_category }}&sort=newest{% else %}?sort=newest{% endif %}">Нові</a>
  </div>

  <!-- Optional: show selected category name (friendly) -->
  {% if selected_category %}
    <div style="text-align:center;margin:6px 0 18px;color:var(--muted);font-weight:700">
      {% if categories and categories.0 %}
        {% for cc in categories %}
          {% if cc.slug == selected_category %}
            <div style="color:var(--white);font-size:1.05rem;margin-bottom:6px;">{{ cc.name }}</div>
          {% endif %}
        {% endfor %}
      {% else %}
        <div style="color:var(--white);font-size:1.05rem;margin-bottom:6px;">{{ selected_category }}</div>
      {% endif %}
    </div>
  {% endif %}

  <div class="products-grid">
  {% for p in products %}
    <article class="product-card"
             data-price="{{ p.price_per_100g|default:'' }}"
             data-name="{{ p.name|default:'' }}"
             data-category="{% if p.category %}{{ p.category.slug }}{% endif %}"
             data-created="{{ p.created_at|date:'c' }}"
             aria-labelledby="p-{{ p.id }}">
      <div class="product-media" role="img" aria-label="{{ p.name }}">
        {% if p.image %}
          <img src="{{ p.image.url }}" alt="{{ p.name }}" loading="lazy"
               onerror="this.onerror=null;this.src='{% static 'images/png/placeholder.png' %}';">
        {% else %}
          <img src="{% static 'images/png/placeholder.png' %}" alt="{{ p.name }}" loading="lazy">
        {% endif %}
      </div>

      <div class="card-body">
        <h3 id="p-{{ p.id }}" class="product-title">{{ p.name }}</h3>
        <div class="product-meta">{{ p.description|default:'' }}</div>
        <div class="price">
  {% if p.package_price_display %}
    <strong>1 шт — {{ p.package_price_display }} грн</strong>
  {% else %}
    {% if p.price_per_100g %}
      <strong>{{ p.price_per_100g|floatformat:2 }} грн / 100г</strong>
    {% else %}
      <span>Ціна уточнюється</span>
    {% endif %}
  {% endif %}
</div>
      </div>

      <div class="product-actions">
        <a href="{% url 'product_details' p.id %}" class="btn btn-primary">Купити</a>
        <a href="{% url 'product_details' p.id %}" class="btn btn-outline">Деталі</a>
      </div>
    </article>
  {% empty %}
    <div style="grid-column:1/-1;color:var(--muted);text-align:center;padding:40px 12px;">
      Немає товарів для показу.
    </div>
  {% endfor %}
</div>
</main>
{% endblock %}