{% extends 'base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ—ñ–ª—å ‚Äî VugriUkraine{% endblock %}

{% block head_extra %}
<style>
:root{--accent:#e75b2e;--muted:#9aa0a6}
.profile-container{max-width:920px;margin:48px auto;padding:28px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.45));border:1px solid rgba(255,255,255,0.03)}
.profile-header{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:18px}
.avatar{width:88px;height:88px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--accent);font-weight:800;color:#fff;font-size:2rem;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
.info-row{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.03)}
.profile-label{color:var(--muted);font-weight:600}
.profile-value{font-weight:700}
.controls{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap;align-items:center}
.profile-btn{display:inline-block;padding:10px 14px;border-radius:10px;text-align:center;text-decoration:none;color:#fff;background:linear-gradient(90deg,var(--accent),#c94b2f);font-weight:700}
.profile-btn-outline{display:inline-block;padding:10px 14px;border-radius:10px;text-align:center;text-decoration:none;color:var(--accent);background:transparent;border:1px solid rgba(255,255,255,0.04);font-weight:700}
.logout-btn{display:block;width:100%;padding:12px;border-radius:10px;background:linear-gradient(90deg,#c0392b,#e74c3c);color:#fff;border:none;margin-top:18px;text-align:center}
.orders-list{padding-left:18px;color:var(--muted);margin:8px 0}
.order-item{margin-bottom:10px;color:var(--muted);background:transparent;padding:8px;border-radius:8px}
.order-item .muted-small{color:rgba(255,255,255,0.6);font-size:13px}

/* Callback button and badge */
.profile-callback-wrap{width:100%;display:flex;justify-content:center;margin-top:12px}
.profile-callback-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#c94b2f);color:#fff;text-decoration:none;font-weight:800}
.profile-callback-badge{background:#ff4757;color:#fff;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}

/* Small helpers */
.empty-note{color:var(--muted);padding:8px 0}
.meta{color:var(--muted);font-size:13px}

/* Responsive */
@media(max-width:720px){.profile-container{margin:28px 12px;padding:16px}.controls{flex-direction:column;align-items:stretch}.profile-callback-btn{width:100%;justify-content:center}}
</style>
{% endblock %}

{% block content %}
  <main class="profile-container" role="main" aria-label="–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞">
    <div class="profile-header" aria-hidden="false">
      <div class="avatar" aria-hidden="true">{{ user.username|slice:":1"|upper }}</div>
      <h2 style="color:#fff;margin:0">–ü—Ä–æ—Ñ—ñ–ª—å ‚Äî {{ user.username }}</h2>
      <div style="color:var(--muted)">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ! –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–≤–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–∫–∞—É–Ω—Ç.</div>
    </div>

    {# –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–∞–ø–∏—Ç—ñ–≤ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É –¥–ª—è VugriUa / superuser #}
    {% if user.is_authenticated and (user.username == 'VugriUa' or user.is_superuser) %}
      <div class="profile-callback-wrap" role="region" aria-label="–ó–∞–ø–∏—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É">
        <a href="{% url 'callback_requests' %}" class="profile-callback-btn" aria-label="–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–∞–ø–∏—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É">
          üì® –ó–∞–ø–∏—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É
          {% if callbacks_unprocessed_count and callbacks_unprocessed_count|int > 0 %}
            <span class="profile-callback-badge" aria-hidden="true">{{ callbacks_unprocessed_count }}</span>
          {% endif %}
        </a>
      </div>
    {% endif %}

    <section class="profile-info" role="region" aria-label="–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" style="margin-top:18px">
      <div class="info-row"><span class="profile-label">–õ–æ–≥—ñ–Ω:</span><span class="profile-value">{{ user.username }}</span></div>
      <div class="info-row"><span class="profile-label">Email:</span><span class="profile-value">{{ user.email|default:"–ù–µ –≤–∫–∞–∑–∞–Ω–æ" }}</span></div>
      <div class="info-row"><span class="profile-label">–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó:</span><span class="profile-value">{{ user.date_joined|date:'d.m.Y H:i' }}</span></div>
    </section>

    <section class="profile-balance" style="margin-top:12px" role="region" aria-label="–ë–∞–ª–∞–Ω—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞">
      <div class="info-row">
        <span class="profile-label">–ë–∞–ª–∞–Ω—Å:</span>
        <span class="profile-value">
         {% if profile and profile.balance %}
           {{ profile.balance }} –≥—Ä–Ω
         {% else %}
           0.00 –≥—Ä–Ω
         {% endif %}
        </span>
      </div>
    </section>

    <section class="profile-tickets" style="margin-top:18px" role="region" aria-label="–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞">
      <div style="display:flex;flex-direction:column;gap:8px;padding:0">
        <span class="profile-label" style="margin-bottom:6px">–í–∞—à—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—É–≥—Ä–∞:</span>

        {% if orders %}
          <ul class="orders-list" aria-live="polite">
            {% for order in orders %}
              <li class="order-item" role="article" aria-label="–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è {{ order.id }}">
                <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap">
                  <div>
                    <strong style="color:var(--fg)">#{{ order.id }}</strong>
                    {% if order.product %}
                      ‚Äî <a href="{% url 'product_details' order.product.id %}" style="color:var(--accent)">{{ order.product.name }}</a>
                    {% else %}
                      ‚Äî <span class="meta">–¢–æ–≤–∞—Ä –≤–∏–¥–∞–ª–µ–Ω–æ</span>
                    {% endif %}
                    <div class="meta">
                      {{ order.quantity_g }} –≥ ‚Äî {{ order.total_price|floatformat:2 }} –≥—Ä–Ω
                    </div>
                  </div>
                  <div class="meta" style="text-align:right">
                    <div>–°—Ç–≤–æ—Ä–µ–Ω–æ: {{ order.created_at|date:'d.m.Y H:i' }}</div>
                    <div style="margin-top:6px">
                      <a class="profile-btn-outline" href="{% url 'order_detail' order.id %}" title="–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</a>
                    </div>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="empty-note">–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å.</div>
        {% endif %}
      </div>
    </section>

    <section class="controls" role="region" aria-label="–î—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" style="margin-top:18px">
      <a href="{% url 'password_change' %}" class="profile-btn" title="–ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å">üîí –ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å</a>
      <a href="{% url 'password_reset' %}" class="profile-btn-outline" title="–°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è">‚ùì –ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
      <a href="#" class="profile-btn-outline" onclick="alert('–§—É–Ω–∫—Ü—ñ—è –∑–º—ñ–Ω–∏ email —É —Ä–æ–∑—Ä–æ–±—Ü—ñ')" title="–ó–º—ñ–Ω–∏—Ç–∏ email">‚úâÔ∏è –ó–º—ñ–Ω–∏—Ç–∏ email</a>

      <a class="btn btn-outline" href="{% url 'archived_conversations' %}" style="margin-left:6px">–ê—Ä—Ö—ñ–≤ —á–∞—Ç—ñ–≤</a>
      <a class="btn btn-outline" href="{% url 'my_conversations' %}" style="margin-left:6px">–ú–æ—ó —á–∞—Ç–∏</a>
      <a class="btn btn-outline" href="{% url 'contact' %}" style="margin-left:6px">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
    </section>

    <form method="post" action="{% url 'logout' %}" style="margin-top:18px">
      {% csrf_token %}
      <button type="submit" class="logout-btn" aria-label="–í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É">üö™ –í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É</button>
    </form>
  </main>
{% endblock %}
