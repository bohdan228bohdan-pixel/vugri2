{% extends 'base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ—ñ–ª—å ‚Äî VugriUkraine{% endblock %}

{% block head_extra %}
<style>
:root{--accent:#e75b2e;--muted:#9aa0a6}
.profile-container{max-width:820px;margin:60px auto;padding:28px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.45));border:1px solid rgba(255,255,255,0.03)}
.profile-header{display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:16px}
.avatar{width:96px;height:96px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--accent);font-weight:800;color:#fff;font-size:2.4rem;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
.info-row{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.03)}
.profile-label{color:var(--muted);font-weight:600}
.profile-value{font-weight:700}
.controls{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap;align-items:center}
.profile-btn{display:inline-block;padding:10px 14px;border-radius:10px;text-align:center;text-decoration:none;color:#fff;background:linear-gradient(90deg,var(--accent),#c94b2f);font-weight:700}
.profile-btn-outline{display:inline-block;padding:10px 14px;border-radius:10px;text-align:center;text-decoration:none;color:var(--accent);background:transparent;border:1px solid rgba(255,255,255,0.04);font-weight:700}
.logout-btn{display:block;width:100%;padding:12px;border-radius:10px;background:linear-gradient(90deg,#c0392b,#e74c3c);color:#fff;border:none;margin-top:18px;text-align:center}
.orders-list{padding-left:18px;color:var(--muted);margin:8px 0}
.order-item{margin-bottom:6px;color:var(--muted)}
.order-item .muted-small{color:rgba(255,255,255,0.6);font-size:13px}

/* Callback button and badge */
.profile-callback-wrap{width:100%;display:flex;justify-content:center;margin-top:12px}
.profile-callback-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#c94b2f);color:#fff;text-decoration:none;font-weight:800}
.profile-callback-badge{background:#ff4757;color:#fff;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}

/* Responsive */
@media(max-width:600px){.profile-container{margin:40px 12px;padding:18px}}
</style>
{% endblock %}

{% block content %}
  <div class="profile-container" data-aos="fade-up">
    <div class="profile-header">
      <div class="avatar" aria-hidden="true">{{ user.username|slice:":1"|upper }}</div>
      <h2 style="color:#fff;margin:0">–ü—Ä–æ—Ñ—ñ–ª—å ‚Äî {{ user.username }}</h2>
      <div style="color:var(--muted)">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ! –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–≤–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–∫–∞—É–Ω—Ç.</div>
    </div>

    <!-- –î–ª—è –≥–æ–ª–æ–≤–Ω–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É VugriUa (–∞–±–æ —Å—É–ø–µ—Ä—é–∑–µ—Ä–∞) –ø–æ–∫–∞–∑—É—î–º–æ —à–≤–∏–¥–∫–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∑–∞–ø–∏—Ç—ñ–≤ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É -->
    {% if user.is_authenticated and (user.username == 'VugriUa' or user.is_superuser) %}
      <div class="profile-callback-wrap" role="region" aria-label="–ó–∞–ø–∏—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É">
        <a href="{% url 'callback_requests' %}" class="profile-callback-btn" aria-label="–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–∞–ø–∏—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É">
          üì® –ó–∞–ø–∏—Ç–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É
          {% if callbacks_unprocessed_count %}
            <span class="profile-callback-badge" aria-hidden="true">{{ callbacks_unprocessed_count }}</span>
          {% endif %}
        </a>
      </div>
    {% endif %}

    <div class="profile-info" role="region" aria-label="–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞">
      <div class="info-row"><span class="profile-label">–õ–æ–≥—ñ–Ω:</span><span class="profile-value">{{ user.username }}</span></div>
      <div class="info-row"><span class="profile-label">Email:</span><span class="profile-value">{{ user.email|default:"–ù–µ –≤–∫–∞–∑–∞–Ω–æ" }}</span></div>
      <div class="info-row"><span class="profile-label">–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó:</span><span class="profile-value">{{ user.date_joined|date:'d.m.Y H:i' }}</span></div>
    </div>

    <div class="profile-balance" style="margin-top:12px">
      <div class="info-row">
        <span class="profile-label">–ë–∞–ª–∞–Ω—Å:</span>
        <span class="profile-value">
         {% if profile and profile.balance %}
          {{ profile.balance }} –≥—Ä–Ω
        {% else %}
          0.00 –≥—Ä–Ω
         {% endif %}
        </span>
      </div>
    </div>

    <div class="profile-tickets" style="margin-top:12px">
      <div class="info-row" style="flex-direction:column;align-items:flex-start;padding:0">
        <span class="profile-label" style="margin-bottom:8px">–í–∞—à—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—É–≥—Ä–∞:</span>
        <ul class="orders-list" aria-live="polite">
          {% for order in orders %}
            <li class="order-item">
              –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{{ order.id }} ‚Äî
              {{ order.product.name }} ‚Äî
              {{ order.quantity_g }} –≥ ‚Äî
              {{ order.total_price|floatformat:2 }} –≥—Ä–Ω
              <div class="muted-small">–°—Ç–≤–æ—Ä–µ–Ω–æ: {{ order.created_at|date:'d.m.Y H:i' }}</div>
            </li>
          {% empty %}
            <li class="order-item">–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å.</li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="controls" role="group" aria-label="–î—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞">
      <a href="{% url 'password_change' %}" class="profile-btn" title="–ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å">üîí –ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å</a>
      <a href="{% url 'password_reset' %}" class="profile-btn-outline" title="–°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è">‚ùì –ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
      <a href="#" class="profile-btn-outline" onclick="alert('–§—É–Ω–∫—Ü—ñ—è –∑–º—ñ–Ω–∏ email —É —Ä–æ–∑—Ä–æ–±—Ü—ñ')" title="–ó–º—ñ–Ω–∏—Ç–∏ email">‚úâÔ∏è –ó–º—ñ–Ω–∏—Ç–∏ email</a>

      <a class="btn btn-outline" href="{% url 'archived_conversations' %}" style="margin-left:6px">–ê—Ä—Ö—ñ–≤ —á–∞—Ç—ñ–≤</a>
      <a class="btn btn-outline" href="{% url 'my_conversations' %}" style="margin-left:6px">–ú–æ—ó —á–∞—Ç–∏</a>
      <a class="btn btn-outline" href="{% url 'contact' %}" style="margin-left:6px">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
    </div>

    <form method="post" action="{% url 'logout' %}">
      {% csrf_token %}
      <button type="submit" class="logout-btn" aria-label="–í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É">üö™ –í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É</button>
    </form>
  </div>
{% endblock %}
